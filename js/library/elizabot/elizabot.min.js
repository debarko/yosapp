function ElizaBot(a){this.noRandom=(a)?true:false;this.capitalizeFirstLetter=true;this.debug=false;this.memSize=20;this.version="1.1 (original)";if(!this._dataParsed){this._init()}this.reset()}ElizaBot.prototype.reset=function(){this.quit=false;this.mem=[];this.lastchoice=[];for(var a=0;a<elizaKeywords.length;a++){this.lastchoice[a]=[];var c=elizaKeywords[a][2];for(var b=0;b<c.length;b++){this.lastchoice[a][b]=-1}}};ElizaBot.prototype._dataParsed=false;ElizaBot.prototype._init=function(){var n=ElizaBot.prototype.global=self;var b={};if((n.elizaSynons)&&(typeof elizaSynons=="object")){for(var p in elizaSynons){b[p]="("+p+"|"+elizaSynons[p].join("|")+")"}}if((!n.elizaKeywords)||(typeof elizaKeywords.length=="undefined")){elizaKeywords=[["###",0,[["###",[]]]]]}var c=/@(\S+)/;var d=/(\S)\s*\*\s*(\S)/;var u=/^\s*\*\s*(\S)/;var t=/(\S)\s*\*\s*$/;var s=/^\s*\*\s*$/;var w=/\s+/g;for(var o=0;o<elizaKeywords.length;o++){var g=elizaKeywords[o][2];elizaKeywords[o][3]=o;for(var p=0;p<g.length;p++){var h=g[p];if(h[0].charAt(0)=="$"){var j=1;while(h[0].charAt[j]==" "){j++}h[0]=h[0].substring(j);h[2]=true}else{h[2]=false}var l=c.exec(h[0]);while(l){var q=(b[l[1]])?b[l[1]]:l[1];h[0]=h[0].substring(0,l.index)+q+h[0].substring(l.index+l[0].length);l=c.exec(h[0])}if(s.test(h[0])){h[0]="\\s*(.*)\\s*"}else{l=d.exec(h[0]);if(l){var e="";var f=h[0];while(l){e+=f.substring(0,l.index+1);if(l[1]!=")"){e+="\\b"}e+="\\s*(.*)\\s*";if((l[2]!="(")&&(l[2]!="\\")){e+="\\b"}e+=l[2];f=f.substring(l.index+l[0].length);l=d.exec(f)}h[0]=e+f}l=u.exec(h[0]);if(l){var e="\\s*(.*)\\s*";if((l[1]!=")")&&(l[1]!="\\")){e+="\\b"}h[0]=e+h[0].substring(l.index-1+l[0].length)}l=t.exec(h[0]);if(l){var e=h[0].substring(0,l.index+1);if(l[1]!="("){e+="\\b"}h[0]=e+"\\s*(.*)\\s*"}}h[0]=h[0].replace(w,"\\s+");w.lastIndex=0}}elizaKeywords.sort(this._sortKeywords);ElizaBot.prototype.pres={};ElizaBot.prototype.posts={};if((n.elizaPres)&&(elizaPres.length)){var v=new Array();for(var p=0;p<elizaPres.length;p+=2){v.push(elizaPres[p]);ElizaBot.prototype.pres[elizaPres[p]]=elizaPres[p+1]}ElizaBot.prototype.preExp=new RegExp("\\b("+v.join("|")+")\\b")}else{ElizaBot.prototype.preExp=/####/;ElizaBot.prototype.pres["####"]="####"}if((n.elizaPosts)&&(elizaPosts.length)){var v=new Array();for(var p=0;p<elizaPosts.length;p+=2){v.push(elizaPosts[p]);ElizaBot.prototype.posts[elizaPosts[p]]=elizaPosts[p+1]}ElizaBot.prototype.postExp=new RegExp("\\b("+v.join("|")+")\\b")}else{ElizaBot.prototype.postExp=/####/;ElizaBot.prototype.posts["####"]="####"}if((!n.elizaQuits)||(typeof elizaQuits.length=="undefined")){elizaQuits=[]}ElizaBot.prototype._dataParsed=true};ElizaBot.prototype._sortKeywords=function(d,c){if(d[1]>c[1]){return -1}else{if(d[1]<c[1]){return 1}else{if(d[3]>c[3]){return 1}else{if(d[3]<c[3]){return -1}else{return 0}}}}};ElizaBot.prototype.transform=function(l){var b="";this.quit=false;l=l.toLowerCase();l=l.replace(/@#\$%\^&\*\(\)_\+=~`\{\[\}\]\|:;<>\/\\\t/g," ");l=l.replace(/\s+-+\s+/g,".");l=l.replace(/\s*[,\.\?!;]+\s*/g,".");l=l.replace(/\s*\bbut\b\s*/g,".");l=l.replace(/\s{2,}/g," ");var f=l.split(".");for(var g=0;g<f.length;g++){var c=f[g];if(c!=""){for(var a=0;a<elizaQuits.length;a++){if(elizaQuits[a]==c){this.quit=true;return this.getFinal()}}var d=this.preExp.exec(c);if(d){var j="";var h=c;while(d){j+=h.substring(0,d.index)+this.pres[d[1]];h=h.substring(d.index+d[0].length);d=this.preExp.exec(h)}c=j+h}this.sentence=c;for(var e=0;e<elizaKeywords.length;e++){if(c.search(new RegExp("\\b"+elizaKeywords[e][0]+"\\b","i"))>=0){b=this._execRule(e)}if(b!=""){return b}}}}b=this._memGet();if(b==""){this.sentence=" ";var e=this._getRuleIndexByKey("xnone");if(e>=0){b=this._execRule(e)}}return(b!="")?b:"I am at a loss for words."};ElizaBot.prototype._execRule=function(g){var o=elizaKeywords[g];var f=o[2];var r=/\(([0-9]+)\)/;for(var h=0;h<f.length;h++){var c=this.sentence.match(f[h][0]);if(c!=null){var t=f[h][1];var d=f[h][2];var p=(this.noRandom)?0:Math.floor(Math.random()*t.length);if(((this.noRandom)&&(this.lastchoice[g][h]>p))||(this.lastchoice[g][h]==p)){p=++this.lastchoice[g][h];if(p>=t.length){p=0;this.lastchoice[g][h]=-1}}else{this.lastchoice[g][h]=p}var a=t[p];if(this.debug){alert("match:\nkey: "+elizaKeywords[g][0]+"\nrank: "+elizaKeywords[g][1]+"\ndecomp: "+f[h][0]+"\nreasmb: "+a+"\nmemflag: "+d)}if(a.search("^goto ","i")==0){ki=this._getRuleIndexByKey(a.substring(5));if(ki>=0){return this._execRule(ki)}}var s=r.exec(a);if(s){var l="";var j=a;while(s){var b=c[parseInt(s[1])];var q=this.postExp.exec(b);if(q){var e="";var n=b;while(q){e+=n.substring(0,q.index)+this.posts[q[1]];n=n.substring(q.index+q[0].length);q=this.postExp.exec(n)}b=e+n}l+=j.substring(0,s.index)+b;j=j.substring(s.index+s[0].length);s=r.exec(j)}a=l+j}a=this._postTransform(a);if(d){this._memSave(a)}else{return a}}}return""};ElizaBot.prototype._postTransform=function(d){d=d.replace(/\s{2,}/g," ");d=d.replace(/\s+\./g,".");if((this.global.elizaPostTransforms)&&(elizaPostTransforms.length)){for(var b=0;b<elizaPostTransforms.length;b+=2){d=d.replace(elizaPostTransforms[b],elizaPostTransforms[b+1]);elizaPostTransforms[b].lastIndex=0}}if(this.capitalizeFirstLetter){var c=/^([a-z])/;var a=c.exec(d);if(a){d=a[0].toUpperCase()+d.substring(1)}}return d};ElizaBot.prototype._getRuleIndexByKey=function(b){for(var a=0;a<elizaKeywords.length;a++){if(elizaKeywords[a][0]==b){return a}}return -1};ElizaBot.prototype._memSave=function(a){this.mem.push(a);if(this.mem.length>this.memSize){this.mem.shift()}};ElizaBot.prototype._memGet=function(){if(this.mem.length){if(this.noRandom){return this.mem.shift()}else{var c=Math.floor(Math.random()*this.mem.length);var a=this.mem[c];for(var b=c+1;b<this.mem.length;b++){this.mem[b-1]=this.mem[b]}this.mem.length--;return a}}else{return""}};ElizaBot.prototype.getFinal=function(){if(!ElizaBot.prototype.global.elizaFinals){return""}return elizaFinals[Math.floor(Math.random()*elizaFinals.length)]};ElizaBot.prototype.getInitial=function(){if(!ElizaBot.prototype.global.elizaInitials){return""}return elizaInitials[Math.floor(Math.random()*elizaInitials.length)]};if(typeof Array.prototype.push=="undefined"){Array.prototype.push=function(a){return this[this.length]=a}}if(typeof Array.prototype.shift=="undefined"){Array.prototype.shift=function(){if(this.length==0){return null}var b=this[0];for(var a=1;a<this.length;a++){this[a-1]=this[a]}this.length--;return b}};